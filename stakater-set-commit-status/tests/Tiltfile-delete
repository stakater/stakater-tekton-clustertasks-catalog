include('Tiltfile')

def delete_operator():
    print('Deleting pipelines operator')
    local('helm uninstall rh-openshift-pipelines-operator || true')

def delete_instance():
    print('Deleting pipelines operator')
    local('helm uninstall rh-openshift-pipelines-instance || true')

def delete_clustertask():
    print('Deleting ClusterTask')
    local('helm uninstall clustertask || true')

# def delete_csvs():
#     print('Deleting csvs')
#     local('oc get subscription.operators.coreos.com stakater-rhsso-operator -n stakater-rhsso-operator -o json | jq \'.status.currentCSV | select(. !=null)\' -r | xargs -I {} -r oc delete clusterserviceversion {} -n stakater-rhsso-operator')

# OLM doesn't deelte CRDs on removal of operator; so, for proper cleanup we have to delete CRDs explicitly
def delete_crds():
    print('Deleting crds')
    local('oc get crds -o name | grep \'.*\\.tekton\\.dev\' | xargs -r -n 1 oc delete')

delete_clustertask()
delete_instance()
delete_operator()
delete_crds()